---
title: "å‰ç«¯æŒç»­é›†æˆä¸éƒ¨ç½²å®è·µ"
excerpt: "æ·±å…¥æ¢è®¨å‰ç«¯æŒç»­é›†æˆä¸éƒ¨ç½²çš„å®è·µæ–¹æ¡ˆï¼ŒåŒ…æ‹¬CI/CDæµç¨‹è®¾è®¡ã€è‡ªåŠ¨åŒ–æ„å»ºã€éƒ¨ç½²ç­–ç•¥ç­‰ï¼Œå¸®åŠ©å›¢é˜Ÿå»ºç«‹é«˜æ•ˆçš„å¼€å‘è¿ç»´ä¸€ä½“åŒ–ä½“ç³»"
coverImage: "/assets/blog/dynamic-routing/cover.jpg"
date: "2025-12-13"
author:
  name: å°ç¾½
  picture: "/assets/blog/authors/jj.jpeg"
ogImage:
  url: "/assets/blog/preview/cover.jpg"
---

# å‰ç«¯æŒç»­é›†æˆä¸éƒ¨ç½²å®è·µ

## æŒç»­é›†æˆä¸éƒ¨ç½²æ¦‚è¿°

### ä»€ä¹ˆæ˜¯CI/CD

CI/CDæ˜¯ç°ä»£è½¯ä»¶å¼€å‘çš„æ ¸å¿ƒå®è·µï¼ŒåŒ…æ‹¬ï¼š

1. **æŒç»­é›†æˆ(Continuous Integration, CI)**ï¼šå¼€å‘äººå‘˜é¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°å…±äº«ä»“åº“ï¼Œæ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨æ„å»ºå’Œæµ‹è¯•éªŒè¯
2. **æŒç»­äº¤ä»˜(Continuous Delivery)**ï¼šç¡®ä¿ä»£ç å¯ä»¥éšæ—¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
3. **æŒç»­éƒ¨ç½²(Continuous Deployment)**ï¼šè‡ªåŠ¨å°†é€šè¿‡æ‰€æœ‰æµ‹è¯•çš„ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### CI/CDçš„ä»·å€¼

1. **æé«˜ä»£ç è´¨é‡**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•å’Œä»£ç æ£€æŸ¥
2. **åŠ é€Ÿäº¤ä»˜å‘¨æœŸ**ï¼šè‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æµç¨‹
3. **é™ä½é£é™©**ï¼šå°æ­¥å¿«è·‘ï¼Œå‡å°‘é›†æˆé—®é¢˜
4. **å¢å¼ºå›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€çš„å¼€å‘æµç¨‹å’Œæ ‡å‡†
5. **å¿«é€Ÿåé¦ˆ**ï¼šåŠæ—¶å‘ç°é—®é¢˜å¹¶ä¿®å¤

### CI/CDæµç¨‹å›¾

```mermaid
graph LR
    A[å¼€å‘äººå‘˜æäº¤ä»£ç ] --> B[è§¦å‘CIæµæ°´çº¿]
    B --> C[ä»£ç æ£€æŸ¥]
    C --> D[å•å…ƒæµ‹è¯•]
    D --> E[æ„å»ºåº”ç”¨]
    E --> F[é›†æˆæµ‹è¯•]
    F --> G[æ„å»ºäº§ç‰©]
    G --> H{æµ‹è¯•é€šè¿‡?}
    H -->|æ˜¯| I[éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ]
    H -->|å¦| J[é€šçŸ¥å¼€å‘äººå‘˜]
    I --> K[ç«¯åˆ°ç«¯æµ‹è¯•]
    K --> L{æµ‹è¯•é€šè¿‡?}
    L -->|æ˜¯| M[éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ]
    L -->|å¦| J
    J --> A
    M --> N[ç›‘æ§ä¸å‘Šè­¦]
```

## CI/CDå·¥å…·é€‰æ‹©

### ä¸»æµCI/CDå¹³å°å¯¹æ¯”

| å¹³å° | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| GitHub Actions | ä¸GitHubæ·±åº¦é›†æˆï¼Œé…ç½®ç®€å• | æ‰§è¡Œå™¨èµ„æºæœ‰é™ | å¼€æºé¡¹ç›®ï¼ŒGitHubæ‰˜ç®¡é¡¹ç›® |
| GitLab CI/CD | åŠŸèƒ½å…¨é¢ï¼Œè‡ªæ‰˜ç®¡é€‰é¡¹ | å­¦ä¹ æ›²çº¿è¾ƒé™¡ | ä¼ä¸šçº§åº”ç”¨ï¼Œéœ€è¦è‡ªæ‰˜ç®¡ |
| Jenkins | é«˜åº¦å¯å®šåˆ¶ï¼Œæ’ä»¶ä¸°å¯Œ | é…ç½®å¤æ‚ï¼Œç»´æŠ¤æˆæœ¬é«˜ | å¤æ‚æ„å»ºæµç¨‹ï¼Œä¼ä¸šç¯å¢ƒ |
| CircleCI | é…ç½®ç®€å•ï¼Œæ‰§è¡Œé€Ÿåº¦å¿« | å…è´¹é¢åº¦æœ‰é™ | ä¸­å°å‹é¡¹ç›®ï¼Œå¿«é€Ÿè¿­ä»£ |
| Travis CI | é…ç½®ç®€å•ï¼Œä¸GitHubé›†æˆå¥½ | å…è´¹ç‰ˆåŠŸèƒ½æœ‰é™ | å¼€æºé¡¹ç›® |

### GitHub Actionsè¯¦è§£

#### GitHub ActionsåŸºç¡€æ¦‚å¿µ

1. **å·¥ä½œæµ(Workflow)**ï¼šå®šä¹‰åœ¨`.github/workflows/`ç›®å½•ä¸‹çš„YAMLæ–‡ä»¶
2. **äº‹ä»¶(Event)**ï¼šè§¦å‘å·¥ä½œæµè¿è¡Œçš„æ´»åŠ¨ï¼Œå¦‚pushã€pull request
3. **ä½œä¸š(Job)**ï¼šå·¥ä½œæµä¸­çš„æ‰§è¡Œå•å…ƒ
4. **æ­¥éª¤(Step)**ï¼šä½œä¸šä¸­çš„å•ä¸ªä»»åŠ¡
5. **åŠ¨ä½œ(Action)**ï¼šå¯é‡ç”¨çš„ä»£ç å•å…ƒ

#### GitHub Actionsé…ç½®ç¤ºä¾‹

```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

# è§¦å‘æ¡ä»¶
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

# ç¯å¢ƒå˜é‡
env:
  NODE_VERSION: '16'
  CACHE_VERSION: 'v1'

# å·¥ä½œæµ
jobs:
  # ä»£ç æ£€æŸ¥å’Œæµ‹è¯•
  test:
    name: Test
    runs-on: ubuntu-latest
    
    # ç¼“å­˜ä¾èµ–
    strategy:
      matrix:
        node-version: [14, 16, 18]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run linter
      run: npm run lint
    
    - name: Run type check
      run: npm run type-check
    
    - name: Run unit tests
      run: npm run test:unit
    
    - name: Run integration tests
      run: npm run test:integration
    
    - name: Upload coverage reports
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/lcov.info
        flags: unittests
        name: codecov-umbrella
  
  # æ„å»ºåº”ç”¨
  build:
    name: Build
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build application
      run: npm run build
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: build-files
        path: dist/
        retention-days: 7
  
  # éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/develop'
    environment: staging
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Download build artifacts
      uses: actions/download-artifact@v3
      with:
        name: build-files
        path: dist/
    
    - name: Deploy to staging
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        destination_dir: staging
    
    - name: Run E2E tests
      run: npm run test:e2e:staging
  
  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Download build artifacts
      uses: actions/download-artifact@v3
      with:
        name: build-files
        path: dist/
    
    - name: Deploy to production
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        destination_dir: .
    
    - name: Notify deployment
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#deployments'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

#### è‡ªå®šä¹‰GitHub Actions

```yaml
# .github/workflows/custom-action.yml
name: Custom Action Demo

on:
  push:
    branches: [ main ]

jobs:
  use-custom-action:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Use custom action
      uses: ./.github/actions/custom-action
      with:
        input-parameter: 'hello-world'
```

```yaml
# .github/actions/custom-action/action.yml
name: 'Custom Action'
description: 'A custom action for demonstration'
inputs:
  input-parameter:
    description: 'An input parameter'
    required: true
    default: 'default-value'
outputs:
  output-parameter:
    description: 'An output parameter'
    value: ${{ steps.step1.outputs.output }}
runs:
  using: 'composite'
  steps:
    - name: Step 1
      id: step1
      shell: bash
      run: |
        echo "Processing input: ${{ inputs.input-parameter }}"
        echo "::set-output name=output::processed-${{ inputs.input-parameter }}"
    
    - name: Step 2
      shell: bash
      run: |
        echo "Output from step 1: ${{ steps.step1.outputs.output }}"
```

## æ„å»ºä¼˜åŒ–ç­–ç•¥

### æ„å»ºæ€§èƒ½ä¼˜åŒ–

#### ä¾èµ–ç¼“å­˜

```yaml
# GitHub Actionsä¸­çš„ä¾èµ–ç¼“å­˜ç¤ºä¾‹
- name: Cache node modules
  uses: actions/cache@v3
  with:
    path: |
      ~/.npm
      node_modules
    key: ${{ runner.os }}-node-${{ env.CACHE_VERSION }}-${{ hashFiles('**/package-lock.json') }}
    restore-keys: |
      ${{ runner.os }}-node-${{ env.CACHE_VERSION }}-
      ${{ runner.os }}-node-
```

#### å¹¶è¡Œæ„å»º

```yaml
# å¹¶è¡Œæ‰§è¡Œæµ‹è¯•
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # å¹¶è¡Œè¿è¡Œä¸åŒç±»å‹çš„æµ‹è¯•
        test-type: [unit, integration, e2e]
        # å¹¶è¡Œè¿è¡Œä¸åŒæµè§ˆå™¨æµ‹è¯•
        browser: [chrome, firefox, safari]
        exclude:
          # æ’é™¤æŸäº›ç»„åˆ
          - test-type: unit
            browser: safari
    
    steps:
    - name: Run ${{ matrix.test-type }} tests on ${{ matrix.browser }}
      run: npm run test:${{ matrix.test-type }}:${{ matrix.browser }}
```

#### å¢é‡æ„å»º

```javascript
// webpack.config.js
module.exports = {
  // å¯ç”¨ç¼“å­˜
  cache: {
    type: 'filesystem',
    buildDependencies: {
      config: [__filename]
    }
  },
  
  // ä»£ç åˆ†å‰²
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all'
        }
      }
    }
  }
};
```

### æ„å»ºäº§ç‰©ä¼˜åŒ–

#### ä»£ç å‹ç¼©ä¸ä¼˜åŒ–

```javascript
// webpack.prod.js
const TerserPlugin = require('terser-webpack-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');

module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new TerserPlugin({
        parallel: true,
        terserOptions: {
          compress: {
            drop_console: true, // ç§»é™¤console
            drop_debugger: true, // ç§»é™¤debugger
            pure_funcs: ['console.log'] // ç§»é™¤ç‰¹å®šå‡½æ•°è°ƒç”¨
          }
        }
      }),
      new CssMinimizerPlugin()
    ]
  }
};
```

#### èµ„æºä¼˜åŒ–

```javascript
// å›¾ç‰‡ä¼˜åŒ–
const ImageMinimizerPlugin = require('image-minimizer-webpack-plugin');

module.exports = {
  plugins: [
    new ImageMinimizerPlugin({
      minimizer: {
        implementation: ImageMinimizerPlugin.imageminMinify,
        options: {
          plugins: [
            ['gifsicle', { optimizationLevel: 7 }],
            ['mozjpeg', { quality: 80 }],
            ['pngquant', { quality: [0.65, 0.8] }],
            ['svgo', { plugins: [{ name: 'removeViewBox', active: false }] }]
          ]
        }
      }
    })
  ]
};
```

## éƒ¨ç½²ç­–ç•¥

### éƒ¨ç½²ç¯å¢ƒç®¡ç†

#### ç¯å¢ƒé…ç½®

```javascript
// config/environments.js
const environments = {
  development: {
    apiUrl: 'http://localhost:3001/api',
    logLevel: 'debug',
    enableMockData: true
  },
  staging: {
    apiUrl: 'https://staging-api.example.com/api',
    logLevel: 'info',
    enableMockData: false
  },
  production: {
    apiUrl: 'https://api.example.com/api',
    logLevel: 'error',
    enableMockData: false
  }
};

const currentEnv = process.env.NODE_ENV || 'development';
module.exports = environments[currentEnv];
```

#### ç¯å¢ƒå˜é‡ç®¡ç†

```yaml
# GitHub Actionsä¸­çš„ç¯å¢ƒå˜é‡
- name: Setup environment variables
  run: |
    echo "API_URL=${{ secrets.API_URL }}" >> .env.production
    echo "API_KEY=${{ secrets.API_KEY }}" >> .env.production
    echo "SENTRY_DSN=${{ secrets.SENTRY_DSN }}" >> .env.production
```

### éƒ¨ç½²ç­–ç•¥ç±»å‹

#### è“ç»¿éƒ¨ç½²

è“ç»¿éƒ¨ç½²æ˜¯é€šè¿‡ç»´æŠ¤ä¸¤ä¸ªç›¸åŒçš„ç”Ÿäº§ç¯å¢ƒï¼ˆè“è‰²å’Œç»¿è‰²ï¼‰æ¥å®ç°é›¶åœæœºéƒ¨ç½²çš„ç­–ç•¥ã€‚

```yaml
# è“ç»¿éƒ¨ç½²ç¤ºä¾‹
- name: Blue-Green Deployment
  run: |
    # æ£€æŸ¥å½“å‰æ´»è·ƒç¯å¢ƒ
    CURRENT_ENV=$(curl -s https://api.example.com/health | jq -r '.environment')
    
    # ç¡®å®šç›®æ ‡ç¯å¢ƒ
    if [ "$CURRENT_ENV" = "blue" ]; then
      TARGET_ENV="green"
    else
      TARGET_ENV="blue"
    fi
    
    # éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒ
    echo "Deploying to $TARGET_ENV environment"
    scp -r dist/ user@${TARGET_ENV}.example.com:/var/www/html/
    
    # å¥åº·æ£€æŸ¥
    curl -f https://${TARGET_ENV}.example.com/health || exit 1
    
    # åˆ‡æ¢æµé‡
    echo "Switching traffic to $TARGET_ENV"
    aws elbv2 modify-listener \
      --listener-arn ${{ secrets.LISTENER_ARN }} \
      --default-actions Type=forward,TargetGroupArn=${{ secrets.${TARGET_ENV}_TARGET_GROUP_ARN }}
    
    echo "Deployment to $TARGET_ENV completed successfully"
```

#### æ»šåŠ¨æ›´æ–°

æ»šåŠ¨æ›´æ–°æ˜¯é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬å®ä¾‹çš„éƒ¨ç½²ç­–ç•¥ã€‚

```yaml
# æ»šåŠ¨æ›´æ–°ç¤ºä¾‹
- name: Rolling Update
  run: |
    # è·å–å½“å‰å®ä¾‹åˆ—è¡¨
    INSTANCES=$(aws ec2 describe-instances \
      --filters "Name=tag:Environment,Values=production" \
      --query "Reservations[*].Instances[*].InstanceId" \
      --output text)
    
    # é€ä¸ªæ›´æ–°å®ä¾‹
    for INSTANCE in $INSTANCES; do
      echo "Updating instance $INSTANCE"
      
      # ä»è´Ÿè½½å‡è¡¡å™¨ä¸­ç§»é™¤å®ä¾‹
      aws elbv2 deregister-targets \
        --target-group-arn ${{ secrets.TARGET_GROUP_ARN }} \
        --targets Id=$INSTANCE
      
      # ç­‰å¾…è¿æ¥æ’ç©º
      sleep 30
      
      # éƒ¨ç½²æ–°ç‰ˆæœ¬
      scp -r dist/ ec2-user@$INSTANCE:/var/www/html/
      
      # å¥åº·æ£€æŸ¥
      ssh ec2-user@$INSTANCE "curl -f http://localhost/health" || exit 1
      
      # é‡æ–°åŠ å…¥è´Ÿè½½å‡è¡¡å™¨
      aws elbv2 register-targets \
        --target-group-arn ${{ secrets.TARGET_GROUP_ARN }} \
        --targets Id=$INSTANCE
      
      echo "Instance $INSTANCE updated successfully"
    done
```

#### é‡‘ä¸é›€å‘å¸ƒ

é‡‘ä¸é›€å‘å¸ƒæ˜¯å°†æ–°ç‰ˆæœ¬å…ˆéƒ¨ç½²ç»™ä¸€å°éƒ¨åˆ†ç”¨æˆ·ï¼ŒéªŒè¯æ— è¯¯åå†å…¨é‡å‘å¸ƒã€‚

```yaml
# é‡‘ä¸é›€å‘å¸ƒç¤ºä¾‹
- name: Canary Deployment
  run: |
    # éƒ¨ç½²é‡‘ä¸é›€ç‰ˆæœ¬
    echo "Deploying canary version"
    scp -r dist/ user@canary.example.com:/var/www/html/
    
    # é…ç½®æµé‡åˆ†é…ï¼ˆ10%åˆ°é‡‘ä¸é›€ç‰ˆæœ¬ï¼‰
    echo "Configuring traffic routing"
    aws apigatewayv2 update-route \
      --api-id ${{ secrets.API_ID }} \
      --route-id ${{ secrets.ROUTE_ID }} \
      --target "canary.example.com"
    
    # è®¾ç½®æƒé‡
    aws apigatewayv2 update-stage \
      --api-id ${{ secrets.API_ID }} \
      --stage-name production \
      --route-settings '{"/": {"LoggingLevel": "INFO", "DataTraceEnabled": true}}'
    
    # ç­‰å¾…éªŒè¯æ—¶é—´
    echo "Waiting for validation"
    sleep 300
    
    # æ£€æŸ¥é‡‘ä¸é›€ç‰ˆæœ¬æŒ‡æ ‡
    ERROR_RATE=$(aws cloudwatch get-metric-statistics \
      --namespace AWS/ApiGateway \
      --metric-name 5XXError \
      --dimensions Name=ApiId,Value=${{ secrets.API_ID }} \
      --start-time $(date -u -v-10M +%Y-%m-%dT%H:%M:%SZ) \
      --end-time $(date -u +%Y-%m-%dT%H:%M:%SZ) \
      --period 60 \
      --statistics Average \
      --query Datapoints[0].Average)
    
    # å¦‚æœé”™è¯¯ç‡ä½äºé˜ˆå€¼ï¼Œç»§ç»­å…¨é‡å‘å¸ƒ
    if (( $(echo "$ERROR_RATE < 0.01" | bc -l) )); then
      echo "Canary validation passed, proceeding with full rollout"
      # é€æ­¥å¢åŠ æµé‡
      for WEIGHT in 20 40 60 80 100; do
        echo "Increasing traffic to $WEIGHT%"
        aws apigatewayv2 update-stage \
          --api-id ${{ secrets.API_ID }} \
          --stage-name production \
          --default-route-settings "{\"ThrottlingBurstLimit\": 5000, \"ThrottlingRateLimit\": 10000, \"DetailedMetricsEnabled\": true, \"LoggingLevel\": \"INFO\", \"DataTraceEnabled\": true, \"CanarySettings\": { \"PercentTraffic\": $WEIGHT }}"
        sleep 60
      done
    else
      echo "Canary validation failed, rolling back"
      # å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
      aws apigatewayv2 update-route \
        --api-id ${{ secrets.API_ID }} \
        --route-id ${{ secrets.ROUTE_ID }} \
        --target "stable.example.com"
      exit 1
    fi
```

## ç›‘æ§ä¸å‘Šè­¦

### åº”ç”¨æ€§èƒ½ç›‘æ§

#### å‰ç«¯æ€§èƒ½ç›‘æ§

```javascript
// æ€§èƒ½ç›‘æ§é…ç½®
import * as Sentry from '@sentry/react';
import { BrowserTracing } from '@sentry/tracing';

Sentry.init({
  dsn: process.env.REACT_APP_SENTRY_DSN,
  integrations: [
    new BrowserTracing({
      routingInstrumentation: Sentry.reactRouterV6Instrumentation(
        React.useEffect,
        useLocation,
        useNavigationType,
        createRoutesFromChildren,
        matchRoutes
      ),
    }),
  ],
  tracesSampleRate: 0.1,
  environment: process.env.NODE_ENV,
  release: `my-app@${process.env.REACT_APP_VERSION}`
});

// è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡
const measurePerformance = (name, fn) => {
  const start = performance.now();
  const result = fn();
  const end = performance.now();
  Sentry.addBreadcrumb({
    message: `Performance: ${name}`,
    level: 'info',
    data: {
      duration: end - start
    }
  });
  return result;
};

// ä½¿ç”¨ç¤ºä¾‹
const fetchUserData = async (userId) => {
  return measurePerformance('fetchUserData', async () => {
    const response = await fetch(`/api/users/${userId}`);
    return response.json();
  });
};
```

#### éƒ¨ç½²ç›‘æ§

```yaml
# éƒ¨ç½²åå¥åº·æ£€æŸ¥
- name: Post-deployment health check
  run: |
    # ç­‰å¾…åº”ç”¨å¯åŠ¨
    sleep 30
    
    # æ£€æŸ¥å¥åº·ç«¯ç‚¹
    for i in {1..10}; do
      if curl -f https://example.com/health; then
        echo "Health check passed"
        break
      else
        echo "Health check failed, retrying... ($i/10)"
        sleep 10
      fi
    done
    
    # æ£€æŸ¥å…³é”®åŠŸèƒ½
    curl -f https://example.com/api/users || exit 1
    curl -f https://example.com/api/products || exit 1
    
    echo "All health checks passed"
```

### å‘Šè­¦é…ç½®

#### Slacké€šçŸ¥

```yaml
# Slacké€šçŸ¥é…ç½®
- name: Notify Slack on failure
  if: failure()
  uses: 8398a7/action-slack@v3
  with:
    status: failure
    channel: '#ci-cd'
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
    fields: repo,message,commit,author,action,eventName,ref,workflow

- name: Notify Slack on success
  if: success()
  uses: 8398a7/action-slack@v3
  with:
    status: success
    channel: '#ci-cd'
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
    text: 'Deployment to production completed successfully! ğŸ‰'
```

#### é‚®ä»¶é€šçŸ¥

```yaml
# é‚®ä»¶é€šçŸ¥é…ç½®
- name: Send email notification
  if: always()
  uses: dawidd6/action-send-mail@v3
  with:
    server_address: smtp.gmail.com
    server_port: 587
    username: ${{ secrets.EMAIL_USERNAME }}
    password: ${{ secrets.EMAIL_PASSWORD }}
    subject: "Deployment ${{ job.status }}: ${{ github.repository }}"
    body: |
      Deployment Status: ${{ job.status }}
      Repository: ${{ github.repository }}
      Branch: ${{ github.ref }}
      Commit: ${{ github.sha }}
      Actor: ${{ github.actor }}
    to: ${{ secrets.NOTIFICATION_EMAIL }}
    from: GitHub Actions
```

## å®é™…åº”ç”¨æ¡ˆä¾‹

### å¤§å‹ç”µå•†å¹³å°CI/CDæµç¨‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¤§å‹ç”µå•†å¹³å°çš„CI/CDå®æ–½æ¡ˆä¾‹ï¼š

#### 1. æ•´ä½“æ¶æ„

```mermaid
graph TD
    A[å¼€å‘äººå‘˜] --> B[Git Push]
    B --> C[GitHub Actions]
    C --> D[ä»£ç æ£€æŸ¥]
    D --> E[å•å…ƒæµ‹è¯•]
    E --> F[æ„å»ºåº”ç”¨]
    F --> G[å®‰å…¨æ‰«æ]
    G --> H[éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ]
    H --> I[é›†æˆæµ‹è¯•]
    I --> J[æ€§èƒ½æµ‹è¯•]
    J --> K[éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒ]
    K --> L[ç”¨æˆ·éªŒæ”¶æµ‹è¯•]
    L --> M{æ‰¹å‡†å‘å¸ƒ?}
    M -->|æ˜¯| N[è“ç»¿éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ]
    M -->|å¦| O[å›æ»š]
    N --> P[ç›‘æ§ä¸å‘Šè­¦]
    O --> Q[ä¿®å¤é—®é¢˜]
    Q --> B
```

#### 2. CI/CDé…ç½®

```yaml
# .github/workflows/ecommerce-pipeline.yml
name: E-commerce CI/CD Pipeline

on:
  push:
    branches: [ main, develop, 'release/*' ]
  pull_request:
    branches: [ main ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥
  quality-check:
    name: Quality Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run ESLint
      run: npm run lint
    
    - name: Run Prettier check
      run: npm run format:check
    
    - name: Run TypeScript check
      run: npm run type-check
    
    - name: Run unit tests
      run: npm run test:unit -- --coverage
    
    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
  
  # å®‰å…¨æ‰«æ
  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest
    needs: quality-check
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Run npm audit
      run: npm audit --audit-level moderate
    
    - name: Run Snyk security scan
      uses: snyk/actions/node@master
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      with:
        args: --severity-threshold=high
  
  # æ„å»ºDockeré•œåƒ
  build-image:
    name: Build Docker Image
    runs-on: ubuntu-latest
    needs: [quality-check, security-scan]
    if: github.event_name == 'push'
    
    outputs:
      image-digest: ${{ steps.build.outputs.digest }}
      image-tag: ${{ steps.meta.outputs.tags }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
    
    - name: Log in to Container Registry
      uses: docker/login-action@v2
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Extract metadata
      id: meta
      uses: docker/metadata-action@v4
      with:
        images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
        tags: |
          type=ref,event=branch
          type=ref,event=pr
          type=sha,prefix={{branch}}-
          type=raw,value=latest,enable={{is_default_branch}}
    
    - name: Build and push Docker image
      id: build
      uses: docker/build-push-action@v4
      with:
        context: .
        push: true
        tags: ${{ steps.meta.outputs.tags }}
        labels: ${{ steps.meta.outputs.labels }}
        cache-from: type=gha
        cache-to: type=gha,mode=max
  
  # éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    needs: build-image
    if: github.ref == 'refs/heads/develop'
    environment: staging
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Deploy to Kubernetes
      run: |
        echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig
        export KUBECONFIG=kubeconfig
        
        # æ›´æ–°é•œåƒæ ‡ç­¾
        sed -i "s|image: .*|image: ${{ needs.build-image.outputs.image-tag }}|g" k8s/staging/deployment.yaml
        
        # åº”ç”¨é…ç½®
        kubectl apply -f k8s/staging/
        
        # ç­‰å¾…éƒ¨ç½²å®Œæˆ
        kubectl rollout status deployment/ecommerce-staging -n staging
    
    - name: Run integration tests
      run: |
        npm run test:integration:staging
    
    - name: Run performance tests
      run: |
        npm run test:performance:staging
  
  # éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒ
  deploy-preprod:
    name: Deploy to Pre-production
    runs-on: ubuntu-latest
    needs: build-image
    if: startsWith(github.ref, 'refs/heads/release/')
    environment: pre-production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Deploy to Kubernetes
      run: |
        echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig
        export KUBECONFIG=kubeconfig
        
        # æ›´æ–°é•œåƒæ ‡ç­¾
        sed -i "s|image: .*|image: ${{ needs.build-image.outputs.image-tag }}|g" k8s/preprod/deployment.yaml
        
        # åº”ç”¨é…ç½®
        kubectl apply -f k8s/preprod/
        
        # ç­‰å¾…éƒ¨ç½²å®Œæˆ
        kubectl rollout status deployment/ecommerce-preprod -n preprod
    
    - name: Run E2E tests
      run: |
        npm run test:e2e:preprod
  
  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build-image
    if: github.ref == 'refs/heads/main'
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Blue-Green Deployment
      run: |
        echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig
        export KUBECONFIG=kubeconfig
        
        # ç¡®å®šå½“å‰æ´»è·ƒç¯å¢ƒ
        CURRENT_SERVICE=$(kubectl get service ecommerce-prod -n production -o jsonpath='{.spec.selector.version}')
        
        if [ "$CURRENT_SERVICE" = "blue" ]; then
          TARGET_VERSION="green"
        else
          TARGET_VERSION="blue"
        fi
        
        echo "Deploying to $TARGET_VERSION environment"
        
        # æ›´æ–°é•œåƒæ ‡ç­¾
        sed -i "s|image: .*|image: ${{ needs.build-image.outputs.image-tag }}|g" k8s/production/deployment-$TARGET_VERSION.yaml
        sed -i "s|version: .*|version: $TARGET_VERSION|g" k8s/production/deployment-$TARGET_VERSION.yaml
        
        # åº”ç”¨é…ç½®
        kubectl apply -f k8s/production/deployment-$TARGET_VERSION.yaml
        
        # ç­‰å¾…éƒ¨ç½²å®Œæˆ
        kubectl rollout status deployment/ecommerce-$TARGET_VERSION -n production
        
        # å¥åº·æ£€æŸ¥
        kubectl wait --for=condition=ready pod -l version=$TARGET_VERSION -n production --timeout=300s
        
        # åˆ‡æ¢æµé‡
        kubectl patch service ecommerce-prod -n production -p '{"spec":{"selector":{"version":"'$TARGET_VERSION'"}}}'
        
        echo "Traffic switched to $TARGET_VERSION environment"
    
    - name: Post-deployment verification
      run: |
        # ç­‰å¾…æµé‡åˆ‡æ¢
        sleep 30
        
        # å¥åº·æ£€æŸ¥
        for i in {1..10}; do
          if curl -f https://ecommerce.example.com/health; then
            echo "Health check passed"
            break
          else
            echo "Health check failed, retrying... ($i/10)"
            sleep 10
          fi
        done
        
        # å…³é”®åŠŸèƒ½æ£€æŸ¥
        curl -f https://ecommerce.example.com/api/products || exit 1
        curl -f https://ecommerce.example.com/api/categories || exit 1
    
    - name: Notify deployment
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#deployments'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        text: 'E-commerce platform deployed to production successfully! ğŸ›’'
```

#### 3. ç›‘æ§ä¸å‘Šè­¦é…ç½®

```yaml
# ç›‘æ§é…ç½®
- name: Setup monitoring
  run: |
    # é…ç½®Prometheusç›‘æ§
    kubectl apply -f monitoring/
    
    # é…ç½®Grafanaä»ªè¡¨æ¿
    kubectl apply -f dashboards/
    
    # é…ç½®å‘Šè­¦è§„åˆ™
    kubectl apply -f alerts/

# å‘Šè­¦é…ç½®
- name: Configure alerts
  run: |
    # åˆ›å»ºPrometheusRule
    cat <<EOF | kubectl apply -f -
    apiVersion: monitoring.coreos.com/v1
    kind: PrometheusRule
    metadata:
      name: ecommerce-alerts
      namespace: monitoring
    spec:
      groups:
      - name: ecommerce.rules
        rules:
        - alert: HighErrorRate
          expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.01
          for: 5m
          labels:
            severity: critical
          annotations:
            summary: "High error rate detected"
            description: "Error rate is {{ $value }} errors per second"
        - alert: HighResponseTime
          expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "High response time detected"
            description: "95th percentile response time is {{ $value }} seconds"
    EOF
```

## æ€»ç»“

å‰ç«¯æŒç»­é›†æˆä¸éƒ¨ç½²æ˜¯ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–çš„æ ¸å¿ƒå®è·µï¼Œé€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·é“¾å¯ä»¥ï¼š

1. **æé«˜å¼€å‘æ•ˆç‡**ï¼šè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹
2. **ä¿è¯ä»£ç è´¨é‡**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•å’Œä»£ç æ£€æŸ¥
3. **é™ä½éƒ¨ç½²é£é™©**ï¼šé€šè¿‡æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥å’Œå›æ»šæœºåˆ¶
4. **åŠ é€Ÿäº¤ä»˜å‘¨æœŸ**ï¼šå‡å°‘æ‰‹åŠ¨æ“ä½œå’Œç­‰å¾…æ—¶é—´
5. **å¢å¼ºç³»ç»Ÿå¯é æ€§**ï¼šé€šè¿‡ç›‘æ§å’Œå‘Šè­¦åŠæ—¶å‘ç°é—®é¢˜

æœ‰æ•ˆçš„CI/CDå®è·µåº”è¯¥ï¼š
- æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·å’Œå¹³å°
- è®¾è®¡åˆç†çš„æµæ°´çº¿é˜¶æ®µå’Œæ£€æŸ¥ç‚¹
- å®æ–½é€‚å½“çš„éƒ¨ç½²ç­–ç•¥ï¼ˆè“ç»¿éƒ¨ç½²ã€æ»šåŠ¨æ›´æ–°ã€é‡‘ä¸é›€å‘å¸ƒï¼‰
- å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- æŒç»­ä¼˜åŒ–å’Œæ”¹è¿›æµç¨‹

é€šè¿‡æŒç»­å®è·µå’Œæ”¹è¿›ï¼Œå›¢é˜Ÿå¯ä»¥å»ºç«‹èµ·é«˜æ•ˆã€å¯é çš„CI/CDæµç¨‹ï¼Œä¸ºå¿«é€Ÿè¿­ä»£å’Œé«˜è´¨é‡äº¤ä»˜æä¾›åšå®ä¿éšœã€‚